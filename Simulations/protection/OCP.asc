Version 4
SHEET 1 2764 2708
WIRE 0 128 -512 128
WIRE 144 128 96 128
WIRE 208 128 144 128
WIRE 368 128 208 128
WIRE 480 128 368 128
WIRE 656 128 480 128
WIRE 704 128 656 128
WIRE 1760 128 800 128
WIRE -512 144 -512 128
WIRE 368 160 368 128
WIRE 1760 160 1760 128
WIRE 144 176 144 128
WIRE 656 192 656 128
WIRE 1984 192 1936 192
WIRE 1392 208 1360 208
WIRE 1456 208 1392 208
WIRE 1872 208 1840 208
WIRE 2096 224 1936 224
WIRE 480 240 480 128
WIRE 1360 240 1360 208
WIRE 2096 240 2096 224
WIRE 368 256 368 240
WIRE 432 256 368 256
WIRE -512 272 -512 224
WIRE 48 272 48 208
WIRE 144 272 144 240
WIRE 144 272 48 272
WIRE 368 272 368 256
WIRE 48 320 48 272
WIRE 656 336 656 256
WIRE 656 336 480 336
WIRE 752 336 752 208
WIRE 752 336 656 336
WIRE 912 336 912 304
WIRE 944 336 912 336
WIRE 1040 336 1024 336
WIRE 368 368 368 336
WIRE -512 384 -512 352
WIRE 1504 416 1504 288
WIRE 1600 416 1504 416
WIRE 2096 416 2096 320
WIRE 48 432 48 400
WIRE 800 464 752 464
WIRE 912 464 912 336
WIRE 912 464 880 464
WIRE 1072 480 1008 480
WIRE 1104 480 1072 480
WIRE 656 496 656 336
WIRE 656 496 -48 496
WIRE 912 496 912 464
WIRE 944 496 912 496
WIRE 1504 496 1504 416
WIRE 1504 496 1440 496
WIRE 1040 512 1040 336
WIRE 1040 512 1008 512
WIRE 1312 512 1312 480
WIRE 1312 512 1040 512
WIRE 1376 512 1312 512
WIRE 1680 512 1680 416
WIRE 1984 512 1984 192
WIRE 1984 512 1680 512
WIRE 1552 528 1440 528
WIRE 1680 528 1680 512
WIRE 1760 544 1760 256
WIRE 1760 544 1728 544
WIRE 2096 576 2096 496
WIRE 176 624 32 624
WIRE 208 624 208 128
WIRE 208 624 176 624
WIRE 320 624 208 624
WIRE 912 624 912 496
WIRE 1072 624 1072 480
WIRE 1552 640 1552 528
WIRE 1728 640 1728 592
WIRE 1760 640 1760 624
WIRE 1760 640 1728 640
WIRE 176 656 176 624
WIRE 1760 656 1760 640
WIRE 1152 672 1136 672
WIRE 528 704 528 688
WIRE 528 704 448 704
WIRE 1152 704 1152 672
WIRE 32 720 32 624
WIRE 912 720 912 704
WIRE 912 720 720 720
WIRE 2096 720 2096 656
WIRE 112 736 80 736
WIRE 320 736 320 624
WIRE 528 752 528 704
WIRE 112 768 112 736
WIRE 176 768 176 720
WIRE 176 768 112 768
WIRE 176 784 176 768
WIRE 448 832 448 704
WIRE 2096 848 2096 800
WIRE -48 880 -48 496
WIRE 32 880 32 816
WIRE 32 880 -48 880
WIRE 176 880 176 864
WIRE 320 880 320 816
WIRE 320 880 176 880
WIRE 368 880 320 880
WIRE 528 880 528 832
WIRE 528 880 464 880
WIRE 1152 880 1152 784
WIRE 1152 880 1088 880
WIRE 1152 896 1152 880
WIRE 32 928 32 880
WIRE 528 960 528 880
WIRE 1152 1024 1152 976
WIRE 528 1136 528 1040
WIRE 752 1136 752 464
WIRE 752 1136 528 1136
WIRE 1152 1152 1152 1104
WIRE 1152 1248 1152 1232
WIRE 1152 1248 1072 1248
WIRE 1152 1264 1152 1248
WIRE 1152 1360 1152 1344
WIRE 1152 1360 1072 1360
WIRE 1152 1376 1152 1360
FLAG 1760 656 0
FLAG 1680 608 0
FLAG -240 560 0
FLAG -352 560 0
FLAG -352 480 12V
FLAG -240 480 -12V
FLAG 1552 720 0
FLAG 1904 240 0
FLAG 1904 176 12V
FLAG 2096 848 0
FLAG 1408 480 12V
FLAG 1408 544 0
FLAG 1312 400 12V
FLAG 976 464 12V
FLAG 976 528 0
FLAG 912 224 12V
FLAG 1104 560 0
FLAG 1104 400 12V
FLAG 1072 720 0
FLAG 48 432 0
FLAG 912 784 0
FLAG 720 720 OCP_EVENT
FLAG 1088 880 RST
FLAG 1152 1376 0
FLAG 1360 320 0
FLAG 1392 208 OCP_override
FLAG 1520 -16 0
FLAG 1520 -96 3V
FLAG 1504 192 3V
FLAG 1696 -16 0
FLAG 1696 -96 5V
FLAG 528 688 3V
FLAG 32 1008 0
FLAG 1904 -16 0
FLAG 1904 -96 -Vcc
FLAG 368 368 0
FLAG -512 384 0
SYMBOL EXTRA\\IRF\\PMOSFET\\irf9540n 752 128 R270
SYMATTR InstName U1
SYMBOL voltage -512 128 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value PULSE({Vin} {-Vin} 6m 1u 1u 1m 100m)
SYMBOL EXTRA\\IRF\\PMOSFET\\irf9540n 48 128 M270
SYMATTR InstName U2
SYMBOL EXTRA\\IRF\\NMOSFET\\irfz44n 1792 208 M0
SYMATTR InstName U3
SYMBOL voltage 2096 560 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value PULSE(0 3 1.1m 900u 1n 1n 100m)
SYMBOL zener 160 240 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D2
SYMATTR Value KDZV16B
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL res 1744 528 R0
SYMATTR InstName R3
SYMATTR Value 0.1
SYMBOL e 1680 512 M0
SYMATTR InstName E1
SYMATTR Value 20
SYMBOL voltage -352 464 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value 9
SYMBOL voltage -240 464 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V4
SYMATTR Value -12
SYMBOL voltage 1552 624 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V5
SYMATTR Value 2
SYMBOL OpAmps\\UniversalOpAmp2 1904 208 M0
SYMATTR InstName U6
SYMATTR SpiceLine Ilimit=200m Rail=0 Vos=0
SYMBOL EXTRA\\ExtraComparators\\LM339A_TI 1408 512 M0
SYMATTR InstName U5
SYMBOL res 1296 384 R0
SYMATTR InstName R4
SYMATTR Value 5k
SYMBOL EXTRA\\ExtraComparators\\LM339A_TI 976 496 M0
SYMATTR InstName U4
SYMBOL res 928 352 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R5
SYMATTR Value 10k
SYMBOL res 896 208 R0
SYMATTR InstName R6
SYMATTR Value 4k
SYMBOL res 1088 384 R0
SYMATTR InstName R7
SYMATTR Value 10k
SYMBOL res 1088 464 R0
SYMATTR InstName R8
SYMATTR Value 40k
SYMBOL voltage 1152 880 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V6
SYMATTR Value PULSE(0 3.3 0.3m 1u 1u 0.3m 100m)
SYMBOL res 1136 688 R0
SYMATTR InstName R9
SYMATTR Value 1k
SYMBOL npn 1136 624 M0
SYMATTR InstName Q3
SYMATTR Value 2N3904
SYMBOL res 896 448 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R10
SYMATTR Value 1m
SYMBOL res 32 304 R0
SYMATTR InstName R11
SYMATTR Value 2k
SYMBOL zener 928 784 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D3
SYMATTR Value 1N749
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL res 896 608 R0
SYMATTR InstName R12
SYMATTR Value 20k
SYMBOL voltage 2096 224 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V7
SYMATTR Value PULSE(0 12 8m 1n 1n 1m 100m)
SYMBOL voltage 1152 1008 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V8
SYMATTR Value PULSE(0 3.3 2.3m 1u 1u 300u 100m)
SYMBOL voltage 1360 224 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V9
SYMATTR Value PULSE(3 0 11.5m 1n 1n 200u 100m)
SYMBOL pmos 1456 288 M180
SYMATTR InstName M1
SYMATTR Value BSS84
SYMBOL res 1584 432 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R14
SYMATTR Value 1k
SYMBOL voltage 1520 -112 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V10
SYMATTR Value 3
SYMBOL voltage 1696 -112 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V11
SYMATTR Value 5
SYMBOL zener 672 256 R180
WINDOW 0 24 64 Left 2
WINDOW 3 -31 -8 Left 2
SYMATTR InstName D1
SYMATTR Value TFZV16B
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL zener 160 720 M180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D4
SYMATTR Value TDZV16
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL nmos 368 832 M90
SYMATTR InstName M2
SYMATTR Value 2N7002
SYMBOL res 544 736 M0
SYMATTR InstName R1
SYMATTR Value 100k
SYMBOL res 336 720 M0
SYMATTR InstName R2
SYMATTR Value 100k
SYMBOL res 48 912 M0
SYMATTR InstName R13
SYMATTR Value 100k
SYMBOL res 192 768 M0
SYMATTR InstName R15
SYMATTR Value 10k
SYMBOL res 544 944 M0
SYMATTR InstName R16
SYMATTR Value 1k
SYMBOL pmos 80 816 R180
SYMATTR InstName M3
SYMATTR Value BSS84
SYMBOL voltage 2096 400 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V14
SYMATTR Value PULSE(0 1 4m 900u 1n 1n 100m)
SYMBOL voltage 1152 1136 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V12
SYMATTR Value PULSE(0 3.3 9.3m 1u 1u 300u 100m)
SYMBOL voltage 2096 704 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V13
SYMATTR Value PULSE(0 1 11m 1n 1n 3m 100m)
SYMBOL voltage 1904 -112 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V15
SYMATTR Value -5
SYMBOL pmos 432 336 M180
SYMATTR InstName M4
SYMATTR Value BSS84
SYMBOL res 352 144 R0
SYMATTR InstName R17
SYMATTR Value 10k
SYMBOL zener 384 336 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D5
SYMATTR Value TDZV22
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL voltage -512 256 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V16
SYMATTR Value PULSE(0 10 13m 1u 1u 1m 100m)
SYMBOL voltage 1152 1248 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V17
SYMATTR Value PULSE(0 3.3 12.3m 1u 1u 300u 100m)
TEXT -384 760 Left 2 !.tran 15m
TEXT 344 -96 Left 2 ;.step param UR list 1k 2k 3k 4k
TEXT 352 -144 Left 2 !.param UR=2k Ratio=7 DR=300
TEXT 344 0 Left 2 ;.step param Ratio list 7  10 13
TEXT -528 8 Left 2 !.param Vin=20
TEXT 1024 -216 Left 2 ;2.5 Rst on\n3.5 rst off\n4 normal current ramp\n5 normal current ramp off\n6 -DUT\n7 +DUT\n8 Current step\n11 current step (poco)\n11.5 OCP override on\n11.7 OCP override off
TEXT 2152 0 Left 2 ;.step dec param Rtest 1 10k 1
